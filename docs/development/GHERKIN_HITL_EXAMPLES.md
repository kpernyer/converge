# Gherkin Examples — Human-in-the-Loop (HITL)

This document provides **concrete Gherkin examples** that show how
Human-in-the-Loop (HITL) is expressed in Converge.

These scenarios are **not tests**.
They are **runtime invariants and acceptance gates** enforced by the engine.

---

## Design Rules Recap

- Gherkin does **not** drive execution
- Gherkin **constrains** execution
- Humans never participate in convergence
- Human decisions are represented as Facts
- Waiting is an explicit engine state

---

## Example 1 — Human Approval Required for Strategy Acceptance

### Intent

A growth strategy may converge computationally, but must not be accepted
without explicit human approval.

---

### Gherkin

```gherkin
Feature: Growth Strategy Acceptance

  Scenario: Strategy requires human approval before acceptance
    Given a strategy proposal has converged
    And the convergence tier is "Primary"
    And no HumanApprovalFact exists
    Then the system must enter WaitingForHuman state
    And no strategy may be marked as Accepted
```

---

### Runtime Meaning

- The engine detects candidate convergence
- Acceptance invariant fails
- Execution halts
- State is persisted
- No output is emitted

---

## Example 2 — Human Approval Unblocks Acceptance

### Intent

Once a human approves the strategy, execution may resume
and acceptance may occur deterministically.

---

### Gherkin

```gherkin
Feature: Human Approval Unblocks Execution

  Scenario: Approved strategy may be accepted
    Given the system is in WaitingForHuman state
    And a HumanDecisionFact exists with decision "Approved"
    Then the system may resume execution
    And the strategy must be marked as Accepted
```

---

### Runtime Meaning

- The HumanDecisionFact is merged into context
- Dirty keys are updated
- The engine runs another cycle
- Acceptance invariant now passes

---

## Example 3 — Human Rejection Blocks Acceptance

### Intent

A human may explicitly reject a converged outcome.

---

### Gherkin

```gherkin
Feature: Human Rejection Handling

  Scenario: Rejected strategy cannot be accepted
    Given a strategy proposal has converged
    And a HumanDecisionFact exists with decision "Rejected"
    Then the strategy must not be marked as Accepted
    And the job must terminate with status "RejectedByHuman"
```

---

### Runtime Meaning

- Rejection is authoritative
- No further exploration is required
- The job ends explicitly and traceably

---

## Example 4 — Human Requests Refinement

### Intent

A human may request refinement without rejecting the strategy outright.

---

### Gherkin

```gherkin
Feature: Human-Requested Refinement

  Scenario: Human requests refinement
    Given the system is in WaitingForHuman state
    And a HumanDecisionFact exists with decision "Refine"
    Then the system must resume execution
    And the convergence tier must be downgraded
    And additional refinement agents may become eligible
```

---

### Runtime Meaning

- Refinement request becomes a Fact
- Convergence tier is adjusted
- Execution resumes with new constraints
- Determinism is preserved

---

## Example 5 — Human Validation of LLM-Proposed Fact

### Intent

LLM outputs may require human validation before promotion.

---

### Gherkin

```gherkin
Feature: Human Validation of LLM Output

  Scenario: Proposed fact requires human validation
    Given a ProposedFact was generated by an LLM
    And the ProposedFact is marked as "HumanValidationRequired"
    And no HumanDecisionFact exists
    Then the ProposedFact must not be promoted to Fact
    And the system must enter WaitingForHuman state
```

---

### Runtime Meaning

- LLM output is quarantined
- No pollution of core context
- Engine waits explicitly for authority

---

## Example 6 — Human-Approved Promotion of ProposedFact

### Intent

A human may explicitly promote an LLM suggestion.

---

### Gherkin

```gherkin
Feature: Human-Approved Fact Promotion

  Scenario: Human approves ProposedFact
    Given the system is in WaitingForHuman state
    And a HumanDecisionFact exists with decision "Approved"
    And the decision references a ProposedFact
    Then the ProposedFact must be promoted to Fact
    And the Fact must record human provenance
```

---

### Runtime Meaning

- Promotion is explicit
- Provenance is preserved
- Deterministic resumption occurs

---

## Example 7 — Waiting Is Quiescent

### Intent

While waiting for a human, nothing else may progress.

---

### Gherkin

```gherkin
Feature: Waiting State Quiescence

  Scenario: No execution during waiting
    Given the system is in WaitingForHuman state
    Then no agents may execute
    And no context mutations may occur
    And no convergence progress may be recorded
```

---

### Runtime Meaning

- Waiting is a frozen state
- No background activity occurs
- Determinism is preserved

---

## Summary

These Gherkin scenarios demonstrate that:

- HITL is enforced via acceptance invariants
- Waiting is explicit and safe
- Humans act as authorities, not agents
- Convergence semantics are unchanged

---

## One-Sentence Takeaway

> **Gherkin expresses when human authority is required; the engine enforces it by halting and resuming deterministically.**
